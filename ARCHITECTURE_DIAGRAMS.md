# ğŸ—ï¸ ARCHITECTURE DIAGRAMS & VISUAL GUIDES

Visual representation of the Whop App architecture, data flows, and key concepts.

---

## 1. System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WHOP ECOSYSTEM                               â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Whop Community Dashboard                         â”‚  â”‚
â”‚  â”‚  - User authentication (JWT)                            â”‚  â”‚
â”‚  â”‚  - Payment processing                                   â”‚  â”‚
â”‚  â”‚  - Community management                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â”‚                                         â”‚
â”‚                  Injects JWT token                              â”‚
â”‚                  (x-whop-user-token)                            â”‚
â”‚                       â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Your Next.js App     â”‚
            â”‚  (Vercel Deployment)  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚          â”‚          â”‚
        â–¼          â–¼          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Frontendâ”‚ â”‚ API Routesâ”‚ â”‚  Services   â”‚
    â”‚ React  â”‚ â”‚ /api/*   â”‚ â”‚             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚          â”‚
                   â–¼          â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Supabase   â”‚ â”‚ Whop Webhooksâ”‚
            â”‚ PostgreSQL â”‚ â”‚ (Payments)   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Complete Request-Response Flow

```
USER VISITS APP:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser opens app (iframe)          â”‚
â”‚ Whop injects JWT in headers         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Next.js: GET / (page.tsx)           â”‚
â”‚ - Extract JWT from headers          â”‚
â”‚ - Call /api/whop/validate-access    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API: GET /api/whop/validate-access  â”‚
â”‚ - Decode JWT token                  â”‚
â”‚ - Query: has_paid from users table  â”‚
â”‚ - Return: { hasAccess: true/false } â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€â†’ if hasAccess â†’ Show app âœ…
             â””â”€â†’ if !hasAccess â†’ Show payment page âŒ

USER UPLOADS VIDEO:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User fills form in VideoExtractor   â”‚
â”‚ - Title: "Python Basics"            â”‚
â”‚ - Mux URL: "https://stream.mux..."  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Form submit â†’ POST /api/videos      â”‚
â”‚ {                                   â”‚
â”‚   userId, title, muxUrl             â”‚
â”‚ }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API: POST /api/videos               â”‚
â”‚ - Validate Mux URL format           â”‚
â”‚ - Generate shareableId (UUID)       â”‚
â”‚ - Insert into videos table          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Return: { id, shareableId, ... }    â”‚
â”‚ Response status: 201 Created        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend shows:                     â”‚
â”‚ "Video uploaded successfully!"      â”‚
â”‚ Shareable link: /video/[uuid]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USER SHARES VIDEO:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Other person opens shareable link   â”‚
â”‚ /video/abc123def456                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Next.js dynamic page                â”‚
â”‚ params.shareableId = "abc123def456" â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API: GET /api/videos/abc123def456   â”‚
â”‚ - Query videos table by shareableId â”‚
â”‚ - Track access in video_accesses    â”‚
â”‚ - Return video metadata + muxUrl    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend renders:                   â”‚
â”‚ - Video player (HLS player)         â”‚
â”‚ - Video title                       â”‚
â”‚ - View/download counts              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Payment & Access Control Flow

```
PAYMENT JOURNEY:

1. DISCOVERY & INSTALLATION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Creator finds app in     â”‚
   â”‚ Whop App Store           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Clicks "Install" in      â”‚
   â”‚ their community          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. PURCHASE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Community member sees    â”‚
   â”‚ app icon                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Clicks to use app        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Whop shows payment modal â”‚
   â”‚ "â‚¬10 one-time"           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ User enters payment info â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Whop processes payment   â”‚
   â”‚ (handles all PCI, etc.)  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. WEBHOOK NOTIFICATION (YOUR APP)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ POST /api/webhooks/whop          â”‚
   â”‚ {                                â”‚
   â”‚   event: "payment.completed",    â”‚
   â”‚   userId: "user_abc123",         â”‚
   â”‚   amount: 10,                    â”‚
   â”‚   currency: "EUR",               â”‚
   â”‚   timestamp: 1629907200          â”‚
   â”‚ }                                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Verify webhook signature âœ…      â”‚
   â”‚ (currently not implemented)      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Query users table:               â”‚
   â”‚ WHERE whop_user_id = user_abc123 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ UPDATE users SET:                â”‚
   â”‚ has_paid = true                  â”‚
   â”‚ payment_date = NOW()             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Return: { success: true }        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. NEXT LOGIN
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ User visits app next time        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ GET /api/whop/validate-access    â”‚
   â”‚ - Get userId from JWT            â”‚
   â”‚ - Query: SELECT has_paid         â”‚
   â”‚   FROM users                     â”‚
   â”‚   WHERE whop_user_id = userId    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”œâ”€â†’ has_paid = true  â†’ ALLOW ACCESS âœ…
            â””â”€â†’ has_paid = false â†’ DENY ACCESS âŒ
```

---

## 4. Database Schema Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        users             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id                (PK)   â”‚
â”‚ whop_user_id (UNIQUE) â—„â”€â”€â”¼â”€â”€â”€â” From JWT token
â”‚ email                    â”‚   â”‚
â”‚ username                 â”‚   â”‚
â”‚ avatar                   â”‚   â”‚
â”‚ has_paid            â­   â”‚   â”‚ Payment status
â”‚ payment_date             â”‚   â”‚ When they paid
â”‚ created_at               â”‚   â”‚
â”‚ updated_at               â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
         â–²                      â”‚
         â”‚ (1 to Many)         â”‚
         â”‚                     â”‚
         â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        videos                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id                  (PK)       â”‚
â”‚ user_id             (FK) â”€â”€â”€â”€â”€â†’ user.id
â”‚ shareable_id        (UNIQUE)  â”‚
â”‚ title                          â”‚
â”‚ description                    â”‚
â”‚ mux_url                        â”‚
â”‚ s3_url                         â”‚
â”‚ view_count                     â”‚
â”‚ download_count                 â”‚
â”‚ created_at                     â”‚
â”‚ updated_at                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ (1 to Many)
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    video_accesses            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id                (PK)       â”‚
â”‚ video_id          (FK) â”€â”€â”€â”€â–º videos.id
â”‚ user_id           (optional) â”‚
â”‚ access_type       ('view' or â”‚ 'download')
â”‚ accessed_at                  â”‚
â”‚ ip_address                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Component Hierarchy

```
â””â”€â”€ app/page.tsx (Root)
    â”œâ”€â”€ State: user, loading, hasAccess
    â”‚
    â”œâ”€ if (loading)
    â”‚  â””â”€ <LoadingSpinner />
    â”‚
    â”œâ”€ if (!hasAccess)
    â”‚  â””â”€ <AccessDeniedScreen />
    â”‚
    â””â”€ if (user && hasAccess)
       â”‚
       â”œâ”€ <Header>
       â”‚  â””â”€ Welcome message with user.username
       â”‚
       â””â”€ <main>
          â”œâ”€ <VideoExtractor />  [2/3 width]
          â”‚  â”œâ”€ Form inputs
          â”‚  â”‚  â”œâ”€ <input> title
          â”‚  â”‚  â””â”€ <textarea> muxUrl
          â”‚  â”‚
          â”‚  â”œâ”€ Buttons
          â”‚  â”‚  â”œâ”€ "Extract Mux URL" â†’ Opens popup
          â”‚  â”‚  â””â”€ "Upload Video" â†’ POST /api/videos
          â”‚  â”‚
          â”‚  â””â”€ Feedback
          â”‚     â”œâ”€ Error message
          â”‚     â”œâ”€ Loading state
          â”‚     â””â”€ Success message
          â”‚
          â””â”€ <HowItWorks />  [1/3 width]
             â””â”€ 4-step guide
```

---

## 6. State Flow (MVVM)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User Interaction          â”‚
â”‚ (Type title, click upload)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   View (React Component)     â”‚
â”‚                              â”‚
â”‚ const [title, setTitle] ...  â”‚
â”‚ const [loading, setLoading]  â”‚
â”‚ const [error, setError]      â”‚
â”‚ const [success, setSuccess]  â”‚
â”‚                              â”‚
â”‚ handleSubmit() calls         â”‚
â”‚ videoViewModel.uploadVideo() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ViewModel (Business Logic)  â”‚
â”‚                              â”‚
â”‚ VideoViewModel {             â”‚
â”‚   uploadVideo() {            â”‚
â”‚     - Validate              â”‚
â”‚     - Call API              â”‚
â”‚     - Update state          â”‚
â”‚     - Return result         â”‚
â”‚   }                          â”‚
â”‚ }                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Model (API Call)           â”‚
â”‚                              â”‚
â”‚ POST /api/videos             â”‚
â”‚ {userId, title, muxUrl}      â”‚
â”‚                              â”‚
â”‚ Returns: {                   â”‚
â”‚   id, shareableId, title,    â”‚
â”‚   createdAt, ...             â”‚
â”‚ }                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend (API Route)         â”‚
â”‚                              â”‚
â”‚ - Validate input            â”‚
â”‚ - Generate UUID             â”‚
â”‚ - Insert to Supabase        â”‚
â”‚ - Return response           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database (Supabase)        â”‚
â”‚                              â”‚
â”‚ INSERT INTO videos (...)    â”‚
â”‚ VALUES (...)                â”‚
â”‚ RETURNING *                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
     [Response flows back â†‘]
```

---

## 7. File Structure Tree

```
app/
â”œâ”€â”€ page.tsx                           Main entry
â”‚   â”œâ”€ useEffect: Initialize app
â”‚   â”œâ”€ whopClient.validateAccess()
â”‚   â”œâ”€ whopClient.getCurrentUser()
â”‚   â””â”€ Render: Home page or access denied
â”‚
â”œâ”€â”€ layout.tsx                         HTML structure
â”‚   â””â”€ Global styling, fonts, head
â”‚
â”œâ”€â”€ globals.css                        Tailwind imports
â”‚
â”œâ”€â”€ models/
â”‚   â””â”€â”€ Video.ts                       Type definitions
â”‚       â”œâ”€ Video interface
â”‚       â”œâ”€ VideoUploadRequest
â”‚       â”œâ”€ VideoResponse
â”‚       â””â”€ VideoStats
â”‚
â”œâ”€â”€ viewmodels/
â”‚   â””â”€â”€ VideoViewModel.ts              Singleton pattern
â”‚       â”œâ”€ uploadVideo()
â”‚       â”œâ”€ getUserVideos()
â”‚       â”œâ”€ deleteVideo()
â”‚       â””â”€ State getters
â”‚
â”œâ”€â”€ views/
â”‚   â””â”€â”€ VideoExtractor.tsx             UI Component
â”‚       â”œâ”€ Form for upload
â”‚       â”œâ”€ Mux URL extraction
â”‚       â”œâ”€ Error/success handling
â”‚       â””â”€ Post message listener
â”‚
â”œâ”€â”€ services/
â”‚   â””â”€â”€ api.service.ts                 (Not used)
â”‚
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts                       Type exports
â”‚
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ constants.ts                   App config
â”‚
â””â”€â”€ api/
    â”œâ”€â”€ videos/
    â”‚   â”œâ”€â”€ route.ts                   POST/GET videos
    â”‚   â”‚   â”œâ”€ POST: Create video
    â”‚   â”‚   â””â”€ GET: List user videos
    â”‚   â””â”€â”€ [shareableId]/
    â”‚       â””â”€â”€ route.ts               GET: Public access
    â”‚
    â”œâ”€â”€ whop/
    â”‚   â”œâ”€â”€ user/
    â”‚   â”‚   â””â”€â”€ route.ts               GET: User info
    â”‚   â”œâ”€â”€ validate-access/
    â”‚   â”‚   â””â”€â”€ route.ts               GET: Payment check
    â”‚   â””â”€â”€ company/
    â”‚       â””â”€â”€ route.ts               GET: Company info
    â”‚
    â””â”€â”€ webhooks/
        â””â”€â”€ whop/
            â””â”€â”€ route.ts               POST: Payment webhook

lib/
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ client.ts                      Supabase singleton
â”‚   â”‚   â””â”€ getSupabaseClient()
â”‚   â””â”€â”€ service.ts                     Database operations
â”‚       â”œâ”€ SupabaseService {
â”‚       â”œâ”€   createVideo()
â”‚       â”œâ”€   getVideo()
â”‚       â”œâ”€   getUserVideos()
â”‚       â”œâ”€   updateVideo()
â”‚       â”œâ”€   deleteVideo()
â”‚       â”œâ”€   trackAccess()
â”‚       â””â”€   getVideoStats()
â”‚
â””â”€â”€ whop/
    â”œâ”€â”€ client.ts                      Browser-side SDK
    â”‚   â””â”€ WhopClient {
    â”‚       â”œâ”€ getCurrentUser()
    â”‚       â”œâ”€ validateAccess()
    â”‚       â”œâ”€ isAdmin()
    â”‚       â””â”€ getCompany()
    â”‚
    â””â”€â”€ server.ts                      Server-side token verification
        â”œâ”€ verifyWhopToken()
        â”œâ”€ getCurrentWhopUser()
        â”œâ”€ checkUserAccess()
        â”œâ”€ markUserAsPaid()
        â””â”€ upsertUser()
```

---

## 8. Data Transformation Pipeline

```
RAW INPUT (form)
â”‚
â”œâ”€ title: "Python Basics"
â”œâ”€ muxUrl: "https://stream.mux.com/abc/manifest.m3u8"
â””â”€ userId: "user_123"
â”‚
â–¼ (Validation)
â”‚
â””â”€ Mux URL format check
   â”œâ”€ Must contain "stream.mux.com"
   â”œâ”€ Must end with ".m3u8"
   â””â”€ Must not be empty
â”‚
â–¼ (Transformation)
â”‚
â”œâ”€ Generate shareableId: UUID.v4()
â””â”€ Create timestamp: NOW()
â”‚
â–¼ (API Model)
â”‚
â”œâ”€ {
â”‚    userId: string
â”‚    shareableId: string
â”‚    title: string
â”‚    muxUrl: string
â”‚    viewCount: 0
â”‚    downloadCount: 0
â”‚  }
â”‚
â–¼ (Database Operation)
â”‚
â”œâ”€ INSERT INTO videos (...)
â”‚  VALUES (...)
â”‚  RETURNING *
â”‚
â–¼ (Response Model)
â”‚
â””â”€ {
     id: UUID
     shareableId: UUID
     title: string
     muxUrl: string
     viewCount: 0
     downloadCount: 0
     createdAt: timestamp
   }
```

---

## 9. Security Verification Flow

```
REQUEST ARRIVES:

1. Extract Token
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Get x-whop-user-token   â”‚
   â”‚ from request headers    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
2. Decode JWT (Basic)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Split by "."                     â”‚
   â”‚ Decode base64 payload            â”‚
   â”‚ Get: { userId, appId, iat, exp } â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
3. Verify JWT (Advanced) âŒ MISSING
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Verify signature using            â”‚
   â”‚ jwt.verify(token, secret)        â”‚
   â”‚ Check expiration (exp < now)     â”‚
   â”‚ âœ… Would ensure token is valid   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
4. Check Payment Status
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Query users table:               â”‚
   â”‚ SELECT has_paid                  â”‚
   â”‚ WHERE whop_user_id = userId      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”œâ”€ has_paid = true  â†’ âœ… ALLOW
            â””â”€ has_paid = false â†’ âŒ DENY
```

---

## 10. Deployment Architecture

```
Your Computer
â”‚
â”œâ”€ npm run build
â”‚  â””â”€ Compile Next.js
â”‚
â”œâ”€ git add .
â”œâ”€ git commit
â””â”€ git push origin main
â”‚
â–¼
GitHub Repository
â”‚
â”œâ”€ Webhook triggers
â””â”€ (linked to Vercel)
â”‚
â–¼
Vercel Build System
â”‚
â”œâ”€ Install dependencies
â”‚  â”œâ”€ npm install
â”‚  â””â”€ Download packages
â”‚
â”œâ”€ Run checks
â”‚  â”œâ”€ npm run type-check (TypeScript)
â”‚  â”œâ”€ npm run lint (Code quality)
â”‚  â””â”€ npm run build (Compile)
â”‚
â”œâ”€ Create bundle
â”‚  â”œâ”€ Minimize code
â”‚  â”œâ”€ Optimize assets
â”‚  â””â”€ Generate static files
â”‚
â””â”€ Deploy to Edge
   â”œâ”€ API routes â†’ Serverless functions
   â”œâ”€ Pages â†’ CDN edge locations
   â””â”€ Static assets â†’ Global CDN
â”‚
â–¼
Production Live
â”‚
â”œâ”€ https://your-app.vercel.app
â”‚
â””â”€ Users access via:
   â”œâ”€ Whop community (embedded)
   â”œâ”€ Direct link
   â””â”€ Shareable links
```

---

## 11. Error Handling Flow

```
API Request
â”‚
â”œâ”€ try {
â”‚  â”‚
â”‚  â”œâ”€ Parse JSON body
â”‚  â”‚
â”‚  â”œâ”€ Validate fields
â”‚  â”‚  â””â”€ If invalid
â”‚  â”‚     â”œâ”€ return 400 (Bad Request)
â”‚  â”‚     â””â”€ { error: "Invalid Mux URL" }
â”‚  â”‚
â”‚  â”œâ”€ Database operation
â”‚  â”‚  â””â”€ If fails
â”‚  â”‚     â”œâ”€ return 500 (Server Error)
â”‚  â”‚     â””â”€ { error: "Failed to create video" }
â”‚  â”‚
â”‚  â””â”€ return 201 (Success)
â”‚     â””â”€ { id, shareableId, ... }
â”‚
â”œâ”€ } catch (error) {
â”‚  â”‚
â”‚  â”œâ”€ Log error
â”‚  â”œâ”€ console.error('Error:', error)
â”‚  â”‚
â”‚  â”œâ”€ Send error response
â”‚  â”œâ”€ return 500
â”‚  â””â”€ { error: "Internal server error" }
â”‚
â””â”€ }
```

---

## 12. Performance Considerations

```
Frontend Performance:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Page Load                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. HTML download ~5KB       â”‚
â”‚ 2. Tailwind CSS ~50KB       â”‚
â”‚ 3. React bundle ~40KB       â”‚
â”‚ 4. App JS ~20KB             â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ Total ~115KB                â”‚
â”‚ Time to Interactive: <1s    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Database Performance:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Query: GET user's videos    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SELECT * FROM videos        â”‚
â”‚ WHERE user_id = $1          â”‚
â”‚ ORDER BY created_at DESC    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ Response time: ~50ms        â”‚
â”‚ (with proper indexes)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

API Performance:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/videos            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Validate: 5ms            â”‚
â”‚ 2. Generate UUID: 1ms       â”‚
â”‚ 3. Database write: 20ms     â”‚
â”‚ 4. Return response: 2ms     â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ Total: ~28ms                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 13. Scaling Considerations

```
Current Setup (MVP)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vercel (Serverless)         â”‚
â”‚ Supabase (Managed)          â”‚
â”‚ Simple routing              â”‚
â”‚ No caching                  â”‚
â”‚ Single region               â”‚
â”‚ â‰ˆ 100s concurrent users OK  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

If 10,000 concurrent users needed:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Vercel handles auto      â”‚
â”‚ âœ… Supabase scales well     â”‚
â”‚ âœ… Add Redis caching        â”‚
â”‚ âœ… Add database read replicas
â”‚ âœ… Add CDN edge caching     â”‚
â”‚ âœ… Implement pagination     â”‚
â”‚ âœ… Optimize images          â”‚
â”‚ âœ… Monitor & alert          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 14. Request Flow Timeline

```
0ms    â”œâ”€ Request starts
       â”‚
5ms    â”œâ”€ Connection established
       â”‚
10ms   â”œâ”€ Headers received
       â”‚  â””â”€ x-whop-user-token extracted
       â”‚
15ms   â”œâ”€ Body parsed
       â”‚  â””â”€ JSON decoded
       â”‚
20ms   â”œâ”€ Validation
       â”‚  â””â”€ Mux URL checked
       â”‚
25ms   â”œâ”€ Database query
       â”‚  â””â”€ INSERT into videos table
       â”‚
45ms   â”œâ”€ Response ready
       â”‚  â””â”€ JSON serialized
       â”‚
50ms   â””â”€ Response sent to client
        â””â”€ Total: 50ms round trip
```

---

## 15. Security Threat Model

```
THREAT: Unauthorized access
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Current                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… JWT extracted               â”‚
â”‚ âŒ JWT signature not verified   â”‚
â”‚ âœ… Payment status checked       â”‚
â”‚ âš ï¸ Payment stored in memory     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Fix: Verify JWT signature

THREAT: Webhook spoofing
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Current                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âŒ No webhook signature check   â”‚
â”‚ âŒ Handler not implemented      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Fix: Verify Whop-Signature header

THREAT: CSRF attacks
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Current                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… Using POST for mutations    â”‚
â”‚ âœ… Within Whop iframe (same-origin) â”‚
â”‚ âš ï¸ No explicit CSRF tokens      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Fix: Add CSRF protection

THREAT: SQL injection
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Current                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… Using Supabase SDK          â”‚
â”‚ âœ… Parameterized queries       â”‚
â”‚ âœ… No raw SQL                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Status: Protected by design

THREAT: XSS attacks
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Current                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… React escapes by default    â”‚
â”‚ âœ… No innerHTML usage          â”‚
â”‚ âš ï¸ Could add CSP headers       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Status: Generally protected
```

---

This completes the architecture documentation!

