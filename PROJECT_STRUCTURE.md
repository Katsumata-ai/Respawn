# Project Structure - Course Downloader

## 📁 Directory Layout

```
whop-downloader/
│
├── 📄 Configuration Files
│   ├── .env.local                 # Environment variables (EDIT THIS!)
│   ├── package.json               # Dependencies
│   ├── tsconfig.json              # TypeScript config
│   ├── next.config.ts             # Next.js config
│   ├── vercel.json                # Vercel deployment config
│   ├── postcss.config.mjs          # PostCSS config
│   └── eslint.config.mjs           # ESLint config
│
├── 📚 Documentation
│   ├── QUICK_START.md             # Start here! 🚀
│   ├── SETUP.md                   # Setup instructions
│   ├── SUPABASE_SETUP.md          # Database setup
│   ├── WHOP_SETUP.md              # Whop configuration
│   ├── DEPLOYMENT.md              # Vercel deployment
│   ├── PROJECT_SUMMARY.md         # Project overview
│   ├── NEXT_STEPS.md              # Detailed next steps
│   └── PROJECT_STRUCTURE.md       # This file
│
├── 📱 Frontend (app/)
│   ├── page.tsx                   # Main page (home)
│   ├── layout.tsx                 # Root layout
│   ├── globals.css                # Global styles
│   │
│   ├── models/
│   │   └── Video.ts               # Video data model
│   │
│   ├── viewmodels/
│   │   └── VideoViewModel.ts      # Business logic (MVVM)
│   │
│   ├── views/
│   │   └── VideoExtractor.tsx     # Video extraction UI
│   │
│   ├── services/
│   │   └── api.service.ts         # API client service
│   │
│   ├── types/
│   │   └── index.ts               # TypeScript types
│   │
│   ├── utils/
│   │   └── constants.ts           # App constants
│   │
│   └── api/
│       ├── videos/
│       │   ├── route.ts           # POST/GET videos
│       │   └── [shareableId]/
│       │       └── route.ts       # GET video by ID
│       │
│       ├── whop/
│       │   ├── user/
│       │   │   └── route.ts       # Get current user
│       │   └── validate-access/
│       │       └── route.ts       # Validate access
│       │
│       └── webhooks/
│           └── whop/
│               └── route.ts       # Whop webhooks (TODO)
│
├── 🗄️ Database (lib/)
│   ├── supabase/
│   │   ├── client.ts              # Supabase client
│   │   └── service.ts             # Database operations
│   │
│   └── whop/
│       └── client.ts              # Whop SDK client
│
├── 🗃️ Database Schema (supabase/)
│   └── migrations/
│       └── 001_create_tables.sql  # Database schema
│
├── 📦 Public Assets (public/)
│   ├── next.svg
│   ├── vercel.svg
│   ├── globe.svg
│   ├── window.svg
│   └── file.svg
│
└── 🔧 Build Output (.next/)
    └── (Generated by Next.js)
```

## 🏗️ Architecture Overview

### MVVM Pattern

```
┌─────────────────────────────────────────────────────┐
│                    Views (React)                     │
│  ┌──────────────────────────────────────────────┐   │
│  │  VideoExtractor.tsx (UI Component)           │   │
│  │  - Form for video upload                     │   │
│  │  - Mux URL extraction                        │   │
│  │  - Error/success messages                    │   │
│  └──────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────┐
│              ViewModels (Business Logic)             │
│  ┌──────────────────────────────────────────────┐   │
│  │  VideoViewModel.ts                           │   │
│  │  - Upload video logic                        │   │
│  │  - Fetch videos                              │   │
│  │  - Validate Mux URLs                         │   │
│  │  - State management                          │   │
│  └──────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────┐
│              Models (Data Layer)                     │
│  ┌──────────────────────────────────────────────┐   │
│  │  Video.ts                                    │   │
│  │  - Video interface                           │   │
│  │  - VideoUploadRequest                        │   │
│  │  - VideoResponse                             │   │
│  │  - VideoStats                                │   │
│  └──────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────┐
│              API Routes (Backend)                    │
│  ┌──────────────────────────────────────────────┐   │
│  │  /api/videos - Create/list videos            │   │
│  │  /api/videos/[id] - Get video by ID          │   │
│  │  /api/whop/user - Get current user           │   │
│  │  /api/whop/validate-access - Check access    │   │
│  └──────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────┐
│              Database (Supabase)                     │
│  ┌──────────────────────────────────────────────┐   │
│  │  videos table                                │   │
│  │  video_accesses table                        │   │
│  │  video_shares table                          │   │
│  └──────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────┘
```

## 📊 Data Flow

```
User Input (VideoExtractor.tsx)
    ↓
VideoViewModel.uploadVideo()
    ↓
API POST /api/videos
    ↓
SupabaseService.createVideo()
    ↓
Supabase Database
    ↓
Return Video with shareableId
    ↓
Display success message
```

## 🔑 Key Files to Edit

### 1. Environment Variables
**File**: `.env.local`
```bash
# Add your Supabase credentials here
NEXT_PUBLIC_SUPABASE_URL=your_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_key
```

### 2. Add Webhook Handler
**File**: `app/api/webhooks/whop/route.ts` (TODO)
```typescript
export async function POST(request: Request) {
  const body = await request.json();
  // Handle payment.completed event
}
```

### 3. Implement Video Processing
**File**: `app/services/video-processor.ts` (TODO)
```typescript
// Use Bull queue + yt-dlp to download videos
// Upload to S3
// Update database
```

## 🚀 Deployment Flow

```
Local Development
    ↓
npm run dev
    ↓
Test at http://localhost:3000
    ↓
Push to GitHub
    ↓
Vercel Auto-Deploy
    ↓
Production at vercel.app
    ↓
Update Whop Dashboard URL
    ↓
Live! 🎉
```

## 📈 Database Schema

### videos table
```sql
id (UUID) → Primary key
user_id (UUID) → Owner
shareable_id (VARCHAR) → Unique link
title (VARCHAR) → Video title
mux_url (VARCHAR) → Original Mux URL
s3_url (VARCHAR) → Permanent S3 URL
view_count (INT) → Number of views
download_count (INT) → Number of downloads
created_at (TIMESTAMP) → Creation date
updated_at (TIMESTAMP) → Last update
```

### video_accesses table
```sql
id (UUID) → Primary key
video_id (UUID) → Foreign key
user_id (UUID) → Accessor
access_type (VARCHAR) → 'view' or 'download'
accessed_at (TIMESTAMP) → Access time
ip_address (VARCHAR) → IP address
```

## 🔄 Development Workflow

1. **Edit code** in `app/` or `lib/`
2. **Save file** - Next.js hot reload
3. **Check browser** - See changes instantly
4. **Test API** - Use Postman or curl
5. **Commit** - `git commit -m "message"`
6. **Push** - `git push origin main`
7. **Deploy** - Vercel auto-deploys

## 📝 Next Files to Create

- [ ] `app/api/webhooks/whop/route.ts` - Webhook handler
- [ ] `app/services/video-processor.ts` - Video processing
- [ ] `app/components/VideoList.tsx` - List user videos
- [ ] `app/components/VideoPlayer.tsx` - Video player
- [ ] `app/api/stream/[videoId]/route.ts` - Streaming endpoint

---

**Ready to start? Open QUICK_START.md! 🚀**

