# Project Structure - Course Downloader

## ğŸ“ Directory Layout

```
whop-downloader/
â”‚
â”œâ”€â”€ ğŸ“„ Configuration Files
â”‚   â”œâ”€â”€ .env.local                 # Environment variables (EDIT THIS!)
â”‚   â”œâ”€â”€ package.json               # Dependencies
â”‚   â”œâ”€â”€ tsconfig.json              # TypeScript config
â”‚   â”œâ”€â”€ next.config.ts             # Next.js config
â”‚   â”œâ”€â”€ vercel.json                # Vercel deployment config
â”‚   â”œâ”€â”€ postcss.config.mjs          # PostCSS config
â”‚   â””â”€â”€ eslint.config.mjs           # ESLint config
â”‚
â”œâ”€â”€ ğŸ“š Documentation
â”‚   â”œâ”€â”€ QUICK_START.md             # Start here! ğŸš€
â”‚   â”œâ”€â”€ SETUP.md                   # Setup instructions
â”‚   â”œâ”€â”€ SUPABASE_SETUP.md          # Database setup
â”‚   â”œâ”€â”€ WHOP_SETUP.md              # Whop configuration
â”‚   â”œâ”€â”€ DEPLOYMENT.md              # Vercel deployment
â”‚   â”œâ”€â”€ PROJECT_SUMMARY.md         # Project overview
â”‚   â”œâ”€â”€ NEXT_STEPS.md              # Detailed next steps
â”‚   â””â”€â”€ PROJECT_STRUCTURE.md       # This file
â”‚
â”œâ”€â”€ ğŸ“± Frontend (app/)
â”‚   â”œâ”€â”€ page.tsx                   # Main page (home)
â”‚   â”œâ”€â”€ layout.tsx                 # Root layout
â”‚   â”œâ”€â”€ globals.css                # Global styles
â”‚   â”‚
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ Video.ts               # Video data model
â”‚   â”‚
â”‚   â”œâ”€â”€ viewmodels/
â”‚   â”‚   â””â”€â”€ VideoViewModel.ts      # Business logic (MVVM)
â”‚   â”‚
â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â””â”€â”€ VideoExtractor.tsx     # Video extraction UI
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ api.service.ts         # API client service
â”‚   â”‚
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ index.ts               # TypeScript types
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ constants.ts           # App constants
â”‚   â”‚
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ videos/
â”‚       â”‚   â”œâ”€â”€ route.ts           # POST/GET videos
â”‚       â”‚   â””â”€â”€ [shareableId]/
â”‚       â”‚       â””â”€â”€ route.ts       # GET video by ID
â”‚       â”‚
â”‚       â”œâ”€â”€ whop/
â”‚       â”‚   â”œâ”€â”€ user/
â”‚       â”‚   â”‚   â””â”€â”€ route.ts       # Get current user
â”‚       â”‚   â””â”€â”€ validate-access/
â”‚       â”‚       â””â”€â”€ route.ts       # Validate access
â”‚       â”‚
â”‚       â””â”€â”€ webhooks/
â”‚           â””â”€â”€ whop/
â”‚               â””â”€â”€ route.ts       # Whop webhooks (TODO)
â”‚
â”œâ”€â”€ ğŸ—„ï¸ Database (lib/)
â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â”œâ”€â”€ client.ts              # Supabase client
â”‚   â”‚   â””â”€â”€ service.ts             # Database operations
â”‚   â”‚
â”‚   â””â”€â”€ whop/
â”‚       â””â”€â”€ client.ts              # Whop SDK client
â”‚
â”œâ”€â”€ ğŸ—ƒï¸ Database Schema (supabase/)
â”‚   â””â”€â”€ migrations/
â”‚       â””â”€â”€ 001_create_tables.sql  # Database schema
â”‚
â”œâ”€â”€ ğŸ“¦ Public Assets (public/)
â”‚   â”œâ”€â”€ next.svg
â”‚   â”œâ”€â”€ vercel.svg
â”‚   â”œâ”€â”€ globe.svg
â”‚   â”œâ”€â”€ window.svg
â”‚   â””â”€â”€ file.svg
â”‚
â””â”€â”€ ğŸ”§ Build Output (.next/)
    â””â”€â”€ (Generated by Next.js)
```

## ğŸ—ï¸ Architecture Overview

### MVVM Pattern

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Views (React)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  VideoExtractor.tsx (UI Component)           â”‚   â”‚
â”‚  â”‚  - Form for video upload                     â”‚   â”‚
â”‚  â”‚  - Mux URL extraction                        â”‚   â”‚
â”‚  â”‚  - Error/success messages                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ViewModels (Business Logic)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  VideoViewModel.ts                           â”‚   â”‚
â”‚  â”‚  - Upload video logic                        â”‚   â”‚
â”‚  â”‚  - Fetch videos                              â”‚   â”‚
â”‚  â”‚  - Validate Mux URLs                         â”‚   â”‚
â”‚  â”‚  - State management                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Models (Data Layer)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Video.ts                                    â”‚   â”‚
â”‚  â”‚  - Video interface                           â”‚   â”‚
â”‚  â”‚  - VideoUploadRequest                        â”‚   â”‚
â”‚  â”‚  - VideoResponse                             â”‚   â”‚
â”‚  â”‚  - VideoStats                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              API Routes (Backend)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  /api/videos - Create/list videos            â”‚   â”‚
â”‚  â”‚  /api/videos/[id] - Get video by ID          â”‚   â”‚
â”‚  â”‚  /api/whop/user - Get current user           â”‚   â”‚
â”‚  â”‚  /api/whop/validate-access - Check access    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Database (Supabase)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  videos table                                â”‚   â”‚
â”‚  â”‚  video_accesses table                        â”‚   â”‚
â”‚  â”‚  video_shares table                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Data Flow

```
User Input (VideoExtractor.tsx)
    â†“
VideoViewModel.uploadVideo()
    â†“
API POST /api/videos
    â†“
SupabaseService.createVideo()
    â†“
Supabase Database
    â†“
Return Video with shareableId
    â†“
Display success message
```

## ğŸ”‘ Key Files to Edit

### 1. Environment Variables
**File**: `.env.local`
```bash
# Add your Supabase credentials here
NEXT_PUBLIC_SUPABASE_URL=your_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_key
```

### 2. Add Webhook Handler
**File**: `app/api/webhooks/whop/route.ts` (TODO)
```typescript
export async function POST(request: Request) {
  const body = await request.json();
  // Handle payment.completed event
}
```

### 3. Implement Video Processing
**File**: `app/services/video-processor.ts` (TODO)
```typescript
// Use Bull queue + yt-dlp to download videos
// Upload to S3
// Update database
```

## ğŸš€ Deployment Flow

```
Local Development
    â†“
npm run dev
    â†“
Test at http://localhost:3000
    â†“
Push to GitHub
    â†“
Vercel Auto-Deploy
    â†“
Production at vercel.app
    â†“
Update Whop Dashboard URL
    â†“
Live! ğŸ‰
```

## ğŸ“ˆ Database Schema

### videos table
```sql
id (UUID) â†’ Primary key
user_id (UUID) â†’ Owner
shareable_id (VARCHAR) â†’ Unique link
title (VARCHAR) â†’ Video title
mux_url (VARCHAR) â†’ Original Mux URL
s3_url (VARCHAR) â†’ Permanent S3 URL
view_count (INT) â†’ Number of views
download_count (INT) â†’ Number of downloads
created_at (TIMESTAMP) â†’ Creation date
updated_at (TIMESTAMP) â†’ Last update
```

### video_accesses table
```sql
id (UUID) â†’ Primary key
video_id (UUID) â†’ Foreign key
user_id (UUID) â†’ Accessor
access_type (VARCHAR) â†’ 'view' or 'download'
accessed_at (TIMESTAMP) â†’ Access time
ip_address (VARCHAR) â†’ IP address
```

## ğŸ”„ Development Workflow

1. **Edit code** in `app/` or `lib/`
2. **Save file** - Next.js hot reload
3. **Check browser** - See changes instantly
4. **Test API** - Use Postman or curl
5. **Commit** - `git commit -m "message"`
6. **Push** - `git push origin main`
7. **Deploy** - Vercel auto-deploys

## ğŸ“ Next Files to Create

- [ ] `app/api/webhooks/whop/route.ts` - Webhook handler
- [ ] `app/services/video-processor.ts` - Video processing
- [ ] `app/components/VideoList.tsx` - List user videos
- [ ] `app/components/VideoPlayer.tsx` - Video player
- [ ] `app/api/stream/[videoId]/route.ts` - Streaming endpoint

---

**Ready to start? Open QUICK_START.md! ğŸš€**

